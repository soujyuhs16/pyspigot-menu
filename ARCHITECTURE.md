# PySpigot Menu System - Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                         PLAYER ACTIONS                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────────┐              ┌──────────────────┐       │
│   │   /menu command  │              │  Right-click     │       │
│   │   (requires OP)  │              │  with Clock      │       │
│   └────────┬─────────┘              └────────┬─────────┘       │
│            │                                 │                 │
│            │                                 │                 │
└────────────┼─────────────────────────────────┼─────────────────┘
             │                                 │
             │                                 │
┌────────────▼─────────────────────────────────▼─────────────────┐
│                         EVENT HANDLERS                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────────┐              ┌──────────────────┐       │
│   │on_menu_command() │              │on_player_interact│       │
│   │  (CommandHandler)│              │  (EventListener) │       │
│   └────────┬─────────┘              └────────┬─────────┘       │
│            │                                 │                 │
│            └────────────┬────────────────────┘                 │
│                         │                                       │
└─────────────────────────┼───────────────────────────────────────┘
                          │
                          │
┌─────────────────────────▼───────────────────────────────────────┐
│                      MENU SYSTEM CORE                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────────────────────────────────────────────┐     │
│   │              open_menu(player)                       │     │
│   │                                                      │     │
│   │  1. Read menu_config                                │     │
│   │  2. Create Bukkit Inventory                         │     │
│   │  3. Add items from config                           │     │
│   │  4. Open for player                                 │     │
│   └──────────────────────────────────────────────────────┘     │
│                                                                 │
│   ┌──────────────────────────────────────────────────────┐     │
│   │         handle_menu_click(event)                     │     │
│   │                                                      │     │
│   │  1. Check if menu inventory                         │     │
│   │  2. Get clicked slot                                │     │
│   │  3. Find action in config                           │     │
│   │  4. Replace placeholders                            │     │
│   │  5. Execute action                                  │     │
│   └──────────────────────────────────────────────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                          │
                          │
┌─────────────────────────▼───────────────────────────────────────┐
│                    CONFIGURATION LAYER                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────────────────────────────────────────────┐     │
│   │              menu.json                               │     │
│   │                                                      │     │
│   │  {                                                   │     │
│   │    "title": "Main Menu",                            │     │
│   │    "size": 27,                                      │     │
│   │    "items": [                                       │     │
│   │      {                                              │     │
│   │        "slot": 10,                                  │     │
│   │        "material": "DIAMOND",                       │     │
│   │        "display_name": "&b&lTeleport Home",         │     │
│   │        "lore": ["&7Click to teleport"],             │     │
│   │        "action": {                                  │     │
│   │          "type": "command",                         │     │
│   │          "value": "spawn"                           │     │
│   │        }                                            │     │
│   │      }                                              │     │
│   │    ]                                                │     │
│   │  }                                                  │     │
│   └──────────────────────────────────────────────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                          │
                          │
┌─────────────────────────▼───────────────────────────────────────┐
│                       ACTION TYPES                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│   │   MESSAGE    │  │   COMMAND    │  │    CLOSE     │         │
│   │              │  │              │  │              │         │
│   │ Send colored │  │ Execute cmd  │  │ Close the    │         │
│   │ message to   │  │ with player  │  │ menu         │         │
│   │ player       │  │ permissions  │  │              │         │
│   └──────────────┘  └──────────────┘  └──────────────┘         │
│                                                                 │
│   Supports placeholders: {player}, {location}                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘


HELPER FUNCTIONS:
┌─────────────────────────────────────────────────────────────────┐
│ • load_menu_config()      - Load JSON configuration             │
│ • translate_color_codes() - Convert & to § for Minecraft        │
│ • create_item()           - Build ItemStack with metadata       │
└─────────────────────────────────────────────────────────────────┘

SECURITY FEATURES:
┌─────────────────────────────────────────────────────────────────┐
│ • Player name sanitization (remove ;, &, |)                     │
│ • Commands run with player permissions (not console)            │
│ • OP-only command access                                        │
│ • Input validation                                              │
└─────────────────────────────────────────────────────────────────┘
```
